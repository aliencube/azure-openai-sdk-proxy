@using AzureOpenAIProxy.PlaygroundApp.Clients
@using AzureOpenAIProxy.PlaygroundApp.Models

@inject OpenAIApiClientOptions Options
@inject IOpenAIApiClient Api

<FluentStack Id="@Id" Style="width: 100%; height: 100%;" Orientation="Orientation.Vertical" VerticalAlignment="VerticalAlignment.Bottom">
    <ChatHistoryComponent Id="chat-history" Messages="messages" />
    <ChatPromptComponent Id="chat-prompt" OnPromptSent="SendPrompt" OnChatCleared="ClearMessage" />
</FluentStack>

@code {
    private List<ChatMessage>? messages;

    [Parameter]
    public string? Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        this.messages = [];

        await Task.CompletedTask;
    }

    private async Task SendPrompt(string prompt)
    {
        this.messages!.Add(new ChatMessage() { Role = MessageRole.User, Message = prompt });
        Options.UserPrompt = prompt;

        await Api.CompleteChatAsync();
        await Task.CompletedTask;
    }

    private async Task ClearMessage()
    {
        this.messages!.Clear();

        await Task.CompletedTask;
    }
}